<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Vocabulary Manager</title>
    <link rel="icon" type="image/png" href="images/logo2.png" />
    <link rel="stylesheet" href="css/index.css" />
    <style></style>
  </head>
  <body>
    <div class="container">
      <h1>Vocabulary Manager</h1>
      <div class="form">
        <input
          type="text"
          id="wordInput"
          autocomplete="off"
          placeholder="English word..."
        />
        <input
          type="text"
          id="meaningInput"
          placeholder="Vietnamese meaning..."
        />
        <select id="categorySelect">
          <option value="General">Contract </option>
          <option value="Office">Office </option>
          <option value="Marketing">Marketing </option>
          <option value="Warranties">Warranties </option>
          <option value="Animals">Animals</option>
          <option value="Food">Food</option>
          <option value="Technology">Technology</option>
          <option value="Position">Position</option>
          <option value="Department">Department</option>
          <option value="academic">Academic</option>
          <option value="event">Event</option>
          <option value="Custom">Custom</option>
        </select>
        <button onclick="addWord()">L∆∞u</button>
      </div>
      <div id="message" class="msg">ƒê√£ l∆∞u t·ª´ v·ª±ng!</div>
      <div class="stats" id="stats">T·ªïng s·ªë t·ª´: 0</div>
      <div id="categories"></div>

      <hr />
      <h2>Ki·ªÉm tra t·ª´ v·ª±ng</h2>
      <select id="quizCategory">
        <option value="All">All Categories</option>
      </select>
      <button onclick="goToQuiz()">B·∫Øt ƒë·∫ßu ki·ªÉm tra</button>
    </div>

    <script>
      let vocab = JSON.parse(localStorage.getItem("vocab")) || {};

      function saveData() {
        localStorage.setItem("vocab", JSON.stringify(vocab));
      }

      function render() {
        const categoriesDiv = document.getElementById("categories");
        const statsDiv = document.getElementById("stats");
        const quizCatSelect = document.getElementById("quizCategory");
        categoriesDiv.innerHTML = "";
        quizCatSelect.innerHTML = '<option value="All">All Categories</option>';

        let total = 0;
        for (const cat in vocab) {
          total += vocab[cat].length;

          const catDiv = document.createElement("div");
          catDiv.className = "category";
          catDiv.innerHTML = `
          <h3 onclick="toggleList(this)">
            ${cat} <span>(${vocab[cat].length})</span>
          </h3>
          <ul>
            ${vocab[cat]
              .map(
                (item, idx) => `
              <li>
                <span><b>${item.en}</b> ‚Äì ${item.vi}</span>
                <div>
                  <button class="delete-btn" onclick="deleteWord('${cat}', ${idx})">X√≥a</button>
                  <button class="delete-btn" onclick="speakText('${item.en}')">üîä</button>  
                </div>
              </li>`
              )
              .join("")}
          </ul>`;
          categoriesDiv.appendChild(catDiv);

          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          quizCatSelect.appendChild(opt);
        }
        statsDiv.textContent = "T·ªïng s·ªë t·ª´: " + total;
      }

      function addWord() {
        const enInput = document.getElementById("wordInput");
        const viInput = document.getElementById("meaningInput");
        const category = document.getElementById("categorySelect").value;
        const enWord = enInput.value.trim();
        const viWord = viInput.value.trim();

        if (enWord && viWord) {
          if (!vocab[category]) vocab[category] = [];
          vocab[category].push({ en: enWord, vi: viWord });
          saveData();
          enInput.value = "";
          viInput.value = "";
          showMsg("ƒê√£ l∆∞u t·ª´ v·ª±ng! ");
          render();
        }
      }

      function deleteWord(cat, index) {
        vocab[cat].splice(index, 1);
        if (vocab[cat].length === 0) delete vocab[cat];
        saveData();
        render();
      }

      function speakText(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "en-US";
        speechSynthesis.speak(utterance);
      }

      function showMsg(text) {
        const msg = document.getElementById("message");
        msg.textContent = text;
        msg.classList.add("show");
        setTimeout(() => msg.classList.remove("show"), 1500);
      }

      function toggleList(h3) {
        const ul = h3.nextElementSibling;
        ul.style.display = ul.style.display === "block" ? "none" : "block";
      }

      function goToQuiz() {
        const cat = document.getElementById("quizCategory").value;
        localStorage.setItem("quizCategory", cat);
        window.location.href = "quiz.html";
      }

      render();
    </script>
  </body>
</html>
